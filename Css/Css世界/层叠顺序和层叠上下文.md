在考虑到两个元素可能重叠的情况下，W3C提出了层叠这个概念，层叠是指如何去层叠另一个元素，比如两个元素重合的时候应该让谁在前面，谁在后面。那它们的规则又是什么？

### 什么是层叠上下文 stacking context

把层叠上下文理解为当官，一旦页面中的元素有了层叠上下文，就好比普通老百姓当了官，等同于网页中元素级别更高，离用户更加接近了。

### 什么是层叠水平 stacking level

决定了同一个层叠上下文中元素在z轴上的显示顺序。所有的元素都有层叠水平。
普通元素的层叠水平优先由层叠上下文决定，因此，层叠水平的比较只有在当前层叠上下文元素中才有意义。

### 什么是层叠顺序 stacking order

表示元素发生层叠时有着特定的垂直显示顺序

<img src="http://image.zhangxinxu.com/image/blog/201601/2016-01-07_223349.png">

为什么内联元素测层叠顺序要比浮动元素的块状元素都高？

<img src="http://image.zhangxinxu.com/image/blog/201601/2016-01-07_235108.png">

### 务必牢记的层叠准则

1. 谁大谁上：当具有明显的层叠水平标示的时候，如识别的z-index值，在同一个层叠上下文领域，层叠水平值大的那个覆盖小的那一个。

2. 后来居上：当元素的层叠水平一致、层叠顺序相同的时候，在DOM流中处于后面的元素会覆盖前面的元素。

### 层叠上下文的特性

层叠上下文元素有如下特性：

* 层叠上下文的层叠水平要比普通元素高；(当官比老百姓更有机会面见圣山)
* 层叠上下文可以阻断元素的混合模式；(领导下去考察，会被当地官员阻隔只看到繁荣看不到真实民情)
* 层叠上下文可以嵌套，内部叠加上下文以及其所有子元素均受制于外部的层叠上下文。(一个家里，爸爸可以当官，孩子可是可以当官的，但是，孩子这个官要受爸爸控制)
* 每个层叠上下文和兄弟元素独立，也就是当进行层叠变化或渲染的时候，只需要考虑后代元素。(自己当官，兄弟不占光。有什么福利或者变故只会影响自己的孩子们)
* 每个层叠上下文是自称体系的，当元素发生层叠的时候，整个元素被认为是在父层叠上下文的层叠顺序中。(每个当官的都有属于自己的小团体, 当家眷管家发生摩擦磕碰的时候，都是要优先看当官的也就是主子的脸色)

### 层叠上下文的创建

1. 皇亲国戚：页面根元素天生有层叠上下文，称之为"根层叠上下文"。

2. 科考入选：z-index值为数值的定位元素的传统层叠上下文。

3. 其他途径： css3属性。

#### 根层叠上下文
指的是页面根元素，也就是滚动条的默认的始作俑者<html>元素。这就是为什么，绝对定位元素在left/top等值定位的时候，如果没有其他元素限制，会相对浏览器窗口定位的原因。

#### 定位元素与传统层叠上下文

包含`postion:relative/postion: absolute`的定位元素以及FireFox/IE下含有`position:fixed`声明的定位元素，当其`z-index`值不是`auto`的时候，会创建层叠上下文。

在过去`position:fixed`和`relative/absolute`在层叠上下文这一块是一路，都需要`z-index`为数值才行。但是不知什么时候起，Chrome等webkit内核浏览器，`position：fixed`元素天然层叠上下文元素，无需`z-index`为数值。

#### css3与新时代的层叠上下文

`transform`等[toread](http://www.zhangxinxu.com/wordpress/2015/05/css3-transform-affect/)

而这里，层叠上下文这一块的影响要更加广泛与显著。

1. `z-index`值不为`auto`的flex项(父元素`display:flex|inline-flex`)
[Demo](http://jsrun.net/3FZKp/edit)

注意：被修改为层叠上下文元素的是flex容器元素的子元素，而非容器元素

2. opacity与层叠上下文
[Demo](http://jsrun.net/eFZKp/edit)

3. transform与层叠上下文
应用了[transform变换](http://www.zhangxinxu.com/wordpress/2010/11/css3-transitions-transforms-animation-introduction/)的元素同样具有层叠上下文。
[Demo](http://jsrun.net/QFZKp/edit)

4. mix-blend-mode与层叠上下文
`mix-blend-mode`类似于PS中的混合模式，有专门的文章[CSS3混合模式mix-blend-mode简介](http://www.zhangxinxu.com/wordpress/2015/05/css3-mix-blend-mode-background-blend-mode/)

5. filter与层叠上下文
CSS3中规范的滤镜
